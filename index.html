<!DOCTYPE html>
<html lang="en" data-theme="light">
    <head>
        <meta charset="UTF-8" />
        <meta name="viewport" content="width=device-width, initial-scale=1.0" />
        <title>LED Calculator</title>
        <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@picocss/pico@2/css/pico.min.css" />
        <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/theme-toggles@4.10.1/css/classic.min.css" />
        <style>
            body {
                padding: 20px;
            }

            .container {
                max-width: 1000px;
            }

            .canvas-container {
                width: 100%;
                max-width: 1000px;
                max-height: 600px;
                overflow: auto;
                margin-top: 20px;
                box-sizing: border-box;
            }

            canvas {
                max-width: 100%;
                max-height: 100%;
                display: block;
                margin: 0 auto;
            }

            .info {
                margin-top: 20px;
            }

            .footer {
                position: relative;
                bottom: 0;
                text-align: center;
                font-size: 14px;
                height: 2.5rem;
                margin-top: 50px;
            }
        </style>
    </head>
    <body>
        <main class="container">
            <div class="theme-toggle" title="Toggle theme">
                <span class="theme-toggle-sr">Toggle theme</span>
                <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" width="1em" height="1em" fill="currentColor" stroke-linecap="round" class="theme-toggle__classic" viewBox="0 0 32 32">
                    <clipPath id="theme-toggle__classic__cutout">
                        <path d="M0-5h30a1 1 0 0 0 9 13v24H0Z" />
                    </clipPath>
                    <g clip-path="url(#theme-toggle__classic__cutout)">
                        <circle cx="16" cy="16" r="9.34" />
                        <g stroke="currentColor" stroke-width="1.5">
                            <path d="M16 5.5v-4" />
                            <path d="M16 30.5v-4" />
                            <path d="M1.5 16h4" />
                            <path d="M26.5 16h4" />
                            <path d="m23.4 8.6 2.8-2.8" />
                            <path d="m5.7 26.3 2.9-2.9" />
                            <path d="m5.8 5.8 2.8 2.8" />
                            <path d="m23.4 23.4 2.9 2.9" />
                        </g>
                    </g>
                </svg>
            </div>

            <h2>LED Resolution Calculator</h2>

            <div>
                <div class="grid">
                    <label>LED Width (W) in meter: <input type="number" id="inputW" step="0.01" /></label>
                    <label>LED Height (H) in meter: <input type="number" id="inputH" step="0.01" /></label>
                    <label for="pitch">
                        LED Pitch
                        <select id="pitch">
                            <option value="2.604">P2.6 (2.604 mm)</option>
                            <option value="2.976">P2.9 (2.976 mm)</option>
                            <option value="3.91">P3.9 (3.91 mm)</option>
                        </select>
                    </label>
                </div>
                <div class="grid">
                    <button type="button" onclick="calculate()">Calculate</button>
                </div>
            </div>

            <div class="canvas-container">
                <canvas id="ledCanvas"></canvas>
            </div>

            <div id="info" class="info"></div>

            <div class="footer">LED Calculator V1.0</div>
        </main>

        <script>
            function getThemeColors() {
                const theme = document.documentElement.getAttribute("data-theme");
                if (theme === "dark") {
                    return {
                        background: "#13171f",
                        box: "#13171f",
                        content: "#29a8e0",
                        textBg: "#29a8e0",
                        textColor: "#ffffff",
                        stroke: "#ffffff",
                        leftover: "red",
                    };
                } else {
                    return {
                        background: "#ffffff",
                        box: "#ffffff",
                        content: "#29a8e0",
                        textBg: "#29a8e0",
                        textColor: "#ffffff",
                        stroke: "#000000",
                        leftover: "red",
                    };
                }
            }

            function calculate() {
                const ledWidth = parseFloat(document.getElementById("inputW").value);
                const ledHeight = parseFloat(document.getElementById("inputH").value);
                const pitch = parseFloat(document.getElementById("pitch").value);

                if (!ledWidth || !ledHeight || ledWidth <= 0 || ledHeight <= 0) {
                    alert("Please enter valid values for Width and Height.");
                    return;
                }

                const colors = getThemeColors();

                const canvas = document.getElementById("ledCanvas");
                const ctx = canvas.getContext("2d");
                const container = document.querySelector(".canvas-container");

                const ledRatio = ledWidth / ledHeight;
                const maxWidth = 1000;
                const maxHeight = 600;
                const canvasRatio = maxWidth / maxHeight;
                let drawWidth, drawHeight;

                if (ledRatio >= canvasRatio) {
                    drawWidth = maxWidth;
                    drawHeight = drawWidth / ledRatio + 100;
                } else {
                    drawHeight = maxHeight;
                    drawWidth = drawHeight * ledRatio + 100;
                }

                canvas.width = drawWidth;
                canvas.height = drawHeight;

                ctx.clearRect(0, 0, canvas.width, canvas.height);
                ctx.fillStyle = colors.background;
                ctx.fillRect(0, 0, canvas.width, canvas.height);

                let contentWidth = (16 / 9) * ledHeight;
                let contentHeight = ledHeight;
                let leftoverX = (ledWidth - contentWidth) / 2;
                let leftoverY = 0;

                if (contentWidth > ledWidth) {
                    contentWidth = ledWidth;
                    contentHeight = (9 / 16) * ledWidth;
                    leftoverX = 0;
                    leftoverY = (ledHeight - contentHeight) / 2;
                }

                const pitchPixel = Math.floor(1000 / pitch);

                const pixelWidth = ledWidth * pitchPixel;
                const pixelHeight = ledHeight * pitchPixel;
                const contentPixelWidth = Math.floor(contentWidth * pitchPixel);
                const contentPixelHeight = Math.floor(contentHeight * pitchPixel);

                const padding = 40;
                const scaleX = (canvas.width - 2 * padding) / ledWidth;
                const scaleY = (canvas.height - 2 * padding) / ledHeight;
                const scale = Math.min(scaleX, scaleY);
                const boxW = ledWidth * scale;
                const boxH = ledHeight * scale;
                const contentW = contentWidth * scale;
                const contentH = contentHeight * scale;
                const offsetX = padding + leftoverX * scale;
                const offsetY = padding + leftoverY * scale;

                ctx.fillStyle = colors.box;
                ctx.fillRect(padding, padding, boxW, boxH);
                ctx.strokeStyle = colors.stroke;
                ctx.lineWidth = 4;
                ctx.strokeRect(padding - 2, padding - 2, boxW + 4, boxH + 4);

                ctx.fillStyle = colors.content;
                ctx.fillRect(offsetX, offsetY, contentW, contentH);

                ctx.strokeStyle = colors.textColor;
                ctx.setLineDash([5, 5]);
                ctx.lineWidth = 1;
                ctx.beginPath();
                ctx.moveTo(offsetX, offsetY);
                ctx.lineTo(offsetX + contentW, offsetY + contentH);
                ctx.moveTo(offsetX + contentW, offsetY);
                ctx.lineTo(offsetX, offsetY + contentH);
                ctx.stroke();
                ctx.setLineDash([]);

                const textLines = ["16:9 Content", `${contentWidth.toFixed(2)} m x ${contentHeight.toFixed(2)} m`, `${contentPixelWidth} px x ${contentPixelHeight} px`];

                ctx.font = "12px sans-serif";
                ctx.textAlign = "center";
                const textHeight = 14;
                const totalTextHeight = textLines.length * textHeight;
                const textX = offsetX + contentW / 2;
                const textY = offsetY + contentH / 2 - totalTextHeight / 2 + textHeight / 2;
                const textWidth = Math.max(...textLines.map((line) => ctx.measureText(line).width));
                const backgroundWidth = textWidth + 20;
                const backgroundHeight = totalTextHeight + 10;

                ctx.fillStyle = colors.textBg;
                ctx.fillRect(textX - backgroundWidth / 2, textY - textHeight / 2 - 5, backgroundWidth, backgroundHeight);

                ctx.fillStyle = colors.textColor;
                for (let i = 0; i < textLines.length; i++) {
                    ctx.fillText(textLines[i], textX, textY + i * textHeight + 3);
                }

                ctx.fillStyle = colors.stroke;
                ctx.font = "12px sans-serif";

                if (leftoverX > 0) {
                    const arrowY = padding - 10;
                    const arrowStartX = offsetX - leftoverX * scale;
                    const arrowEndX = offsetX;

                    ctx.beginPath();
                    ctx.moveTo(arrowStartX, arrowY);
                    ctx.lineTo(arrowEndX, arrowY);
                    ctx.strokeStyle = colors.leftover;
                    ctx.lineWidth = 1;
                    ctx.stroke();

                    ctx.beginPath();
                    ctx.moveTo(arrowStartX, arrowY - 3);
                    ctx.lineTo(arrowStartX, arrowY + 3);
                    ctx.moveTo(arrowEndX, arrowY - 3);
                    ctx.lineTo(arrowEndX, arrowY + 3);
                    ctx.stroke();

                    ctx.fillText(`Leftover ${leftoverX.toFixed(2)} m`, (arrowStartX + arrowEndX) / 2, arrowY - 5);
                }

                if (leftoverY > 0) {
                    const arrowX = padding - 10;
                    const arrowStartY = offsetY - leftoverY * scale;
                    const arrowEndY = offsetY;

                    ctx.beginPath();
                    ctx.moveTo(arrowX, arrowStartY);
                    ctx.lineTo(arrowX, arrowEndY);
                    ctx.strokeStyle = colors.leftover;
                    ctx.lineWidth = 1;
                    ctx.stroke();

                    ctx.beginPath();
                    ctx.moveTo(arrowX - 3, arrowStartY);
                    ctx.lineTo(arrowX + 3, arrowStartY);
                    ctx.moveTo(arrowX - 3, arrowEndY);
                    ctx.lineTo(arrowX + 3, arrowEndY);
                    ctx.stroke();

                    ctx.save();
                    ctx.translate(padding - 15, (arrowStartY + arrowEndY) / 2);
                    ctx.rotate(-Math.PI / 2);
                    ctx.fillText(`Leftover ${leftoverY.toFixed(2)} m`, 0, 0);
                    ctx.restore();
                }

                const leftover = leftoverX > 0 ? leftoverX : leftoverY;

                ctx.font = "16px sans-serif";
                ctx.fillText(`W: ${ledWidth.toFixed(2)} m / ${pixelWidth} px`, padding + boxW / 2, padding + boxH + 25);
                ctx.save();
                ctx.translate(padding + boxW + 25, padding + boxH / 2);
                ctx.rotate(-Math.PI / 2);
                ctx.fillText(`H: ${ledHeight.toFixed(2)} m / ${pixelHeight} px`, 0, 0);
                ctx.restore();

                document.getElementById("info").innerHTML = `
                <div class='grid'>
                    <div>
                        <strong>Pitch Resolution:</strong><br/>
                        ${pitch} mm <br/>
                        ${Math.floor(1000 / pitch)} px
                    </div>
                    <div>
                        <strong>LED Size:</strong><br/>
                        ${ledWidth.toFixed(2)} m x ${ledHeight.toFixed(2)} m <br/>
                        (${pixelWidth} px x ${pixelHeight} px)
                    </div>
                    <div>
                        <strong>16:9 Content Size:</strong><br/>
                        ${contentWidth.toFixed(2)} m x ${contentHeight.toFixed(2)} m <br/>
                        (${contentPixelWidth} px x ${contentPixelHeight} px)
                    </div>
                    <div>
                        <strong>Leftover:</strong><br/>
                        ${leftover.toFixed(2)} m
                    </div>
                </div>
                `;
            }

            window.addEventListener("resize", () => {
                const W = parseFloat(document.getElementById("inputW").value);
                const H = parseFloat(document.getElementById("inputH").value);
                if (W && H) calculate();
            });

            const buttonTheme = document.querySelector(".theme-toggle");
            const html = document.documentElement;

            function setTheme(theme) {
                html.setAttribute("data-theme", theme);
                localStorage.setItem("theme", theme);
                if (document.getElementById("inputW").value && document.getElementById("inputH").value) {
                    calculate(); // redraw canvas after theme change
                }
            }

            function toggleTheme() {
                const currentTheme = html.getAttribute("data-theme");
                const newTheme = currentTheme === "light" ? "dark" : "light";
                setTheme(newTheme);
                buttonTheme.classList.toggle("theme-toggle--toggled", newTheme === "dark");
            }

            buttonTheme.addEventListener("click", toggleTheme);

            // Load theme from localStorage
            const savedTheme = localStorage.getItem("theme");
            if (savedTheme) {
                setTheme(savedTheme);
            } else {
                // Optionally detect system preference
                const prefersDark = window.matchMedia("(prefers-color-scheme: dark)").matches;
                setTheme(prefersDark ? "dark" : "light");
            }
        </script>
    </body>
</html>
